<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Deteksi Device Lengkap</title>
</head>
<body>
  <h1>Deteksi Device Lengkap</h1>
  <pre id="output">Loading...</pre>

  <!-- FingerprintJS OSS via CDN (opsional tapi disarankan) -->
  <script>
    // Load FingerprintJS dari CDN (OSS v3/v4 contoh)
    const fpPromise = import('https://openfpcdn.io/fingerprintjs/v3')
      .then(FingerprintJS => FingerprintJS.load());
  </script>

  <script>
    // ====== 1. Device ID pseudo yang stabil (localStorage) ======
    function getOrCreateDeviceId() {
      const KEY = 'MY_APP_DEVICE_ID_V1';
      let existing = localStorage.getItem(KEY);
      if (existing) return existing;

      const randomPart = Math.random().toString(36).substring(2, 10);
      const timePart = Date.now().toString(36);
      const newId = `DEV-${timePart}-${randomPart}`.toUpperCase();

      localStorage.setItem(KEY, newId);
      return newId;
    }

    // ====== 2. Deteksi OS ======
    function detectOS(ua) {
      ua = ua || navigator.userAgent;
      const lower = ua.toLowerCase();

      let osName = 'Unknown';
      let osVersion = '';

      if (lower.indexOf('android') !== -1) {
        osName = 'Android';
        const match = lower.match(/android\s([0-9._]+)/);
        if (match) osVersion = match[1].replace(/_/g, '.');
      } else if (/iphone|ipad|ipod/.test(lower)) {
        osName = 'iOS';
        const match = lower.match(/os\s([0-9_]+)\slike mac os x/);
        if (match) osVersion = match[1].replace(/_/g, '.');
      } else if (lower.indexOf('windows nt') !== -1) {
        osName = 'Windows';
        const match = lower.match(/windows nt\s([0-9._]+)/);
        if (match) osVersion = match[1];
      } else if (lower.indexOf('mac os x') !== -1) {
        osName = 'macOS';
        const match = lower.match(/mac os x\s([0-9._]+)/);
        if (match) osVersion = match[1].replace(/_/g, '.');
      } else if (lower.indexOf('linux') !== -1) {
        osName = 'Linux';
      }

      return { osName, osVersion };
    }

    // ====== 3. Deteksi Browser ======
    function detectBrowser(ua) {
      ua = ua || navigator.userAgent;

      let name = 'Unknown';
      let version = '';

      if (/Edg\//.test(ua)) {
        name = 'Edge';
        const m = ua.match(/Edg\/([\d.]+)/);
        if (m) version = m[1];
      } else if (/OPR\//.test(ua) || /Opera/.test(ua)) {
        name = 'Opera';
        const m = ua.match(/OPR\/([\d.]+)/) || ua.match(/Opera\/([\d.]+)/);
        if (m) version = m[1];
      } else if (/SamsungBrowser\//.test(ua)) {
        name = 'Samsung Internet';
        const m = ua.match(/SamsungBrowser\/([\d.]+)/);
        if (m) version = m[1];
      } else if (/Chrome\//.test(ua) && !/Chromium/.test(ua)) {
        name = 'Chrome';
        const m = ua.match(/Chrome\/([\d.]+)/);
        if (m) version = m[1];
      } else if (/Safari\//.test(ua) && /Version\//.test(ua)) {
        name = 'Safari';
        const m = ua.match(/Version\/([\d.]+)/);
        if (m) version = m[1];
      } else if (/Firefox\//.test(ua)) {
        name = 'Firefox';
        const m = ua.match(/Firefox\/([\d.]+)/);
        if (m) version = m[1];
      }

      return { browserName: name, browserVersion: version };
    }

    // ====== 4. Deteksi tipe device ======
    function detectDeviceType(ua) {
      ua = ua || navigator.userAgent;

      if (/Tablet|iPad/i.test(ua)) {
        return 'Tablet';
      } else if (/Mobi|Android/i.test(ua)) {
        return 'Mobile';
      } else {
        return 'Desktop';
      }
    }

    // ====== 5. Deteksi model dari UA (fallback) ======
    function detectDeviceModelFromUA(ua) {
      ua = ua || navigator.userAgent;

      // Contoh UA Android:
      // Mozilla/5.0 (Linux; Android 12; SM-G990B Build/...)
      let match = ua.match(/Android [\d._]+;\s*([^;()]+)[;)]/);
      if (match && match[1]) {
        return match[1].trim();
      }

      if (/iPhone/.test(ua)) return 'iPhone';
      if (/iPad/.test(ua)) return 'iPad';
      if (/iPod/.test(ua)) return 'iPod';

      return '';
    }

    // ====== 6. Coba ambil model via User-Agent Client Hints (jika ada) ======
    async function getModelFromClientHints() {
      if (!navigator.userAgentData || !navigator.userAgentData.getHighEntropyValues) {
        return null;
      }

      try {
        const hints = await navigator.userAgentData.getHighEntropyValues([
          "model",
          "platform",
          "platformVersion",
          "fullVersionList"
        ]);
        // hints.model bisa berisi model device di browser Chromium (Android/Windows tertentu)
        return {
          model: hints.model || null,
          platform: hints.platform || null,
          platformVersion: hints.platformVersion || null,
          fullVersionList: hints.fullVersionList || null
        };
      } catch (e) {
        console.warn('Client Hints not allowed or failed:', e);
        return null;
      }
    }

    // ====== 7. Fungsi utama untuk kumpulkan info device ======
    async function getDeviceInfoFull() {
      const ua = navigator.userAgent;
      const { osName, osVersion } = detectOS(ua);
      const { browserName, browserVersion } = detectBrowser(ua);
      const deviceType = detectDeviceType(ua);

      const deviceId = getOrCreateDeviceId();

      // Client Hints model (kalau didukung)
      const ch = await getModelFromClientHints();
      let deviceModel = '';
      if (ch && ch.model) {
        deviceModel = ch.model; // contoh: "SM-G990B"
      } else {
        deviceModel = detectDeviceModelFromUA(ua);
      }

      // FingerprintJS (opsional tapi berguna)
      let fingerprintVisitorId = null;
      try {
        const fp = await fpPromise;
        const result = await fp.get();
        fingerprintVisitorId = result.visitorId || null;
      } catch (e) {
        console.warn('FingerprintJS error:', e);
      }

      return {
        deviceId,                 // pseudo ID (localStorage, stabil di browser ini)
        fingerprintVisitorId,     // fingerprint dari FingerprintJS (opsional)
        deviceType,               // Mobile / Tablet / Desktop
        deviceModel,              // contoh: "SM-G990B" jika terdeteksi
        osName,
        osVersion,
        browserName,
        browserVersion,
        userAgent: ua,
        userAgentDataSupported: !!navigator.userAgentData,
        clientHints: ch,          // info tambahan dari Client Hints (bisa null)
        screen: {
          width: window.screen.width,
          height: window.screen.height,
          innerWidth: window.innerWidth,
          innerHeight: window.innerHeight
        },
        language: navigator.language || navigator.userLanguage,
        online: navigator.onLine,
        time: new Date().toISOString()
      };
    }

    // ====== 8. Eksekusi saat halaman siap ======
    (async () => {
      try {
        const info = await getDeviceInfoFull();
        console.log(info);
        document.getElementById('output').textContent =
          JSON.stringify(info, null, 2);
      } catch (e) {
        console.error(e);
        document.getElementById('output').textContent =
          'Error mengambil info device: ' + e.message;
      }
    })();
  </script>
</body>
</html>
